require=function e(t,n,i){function a(s,c){if(!n[s]){if(!t[s]){var u="function"==typeof require&&require;if(!c&&u)return u(s,!0);if(o)return o(s,!0);var h=new Error("Cannot find module '"+s+"'");throw h.code="MODULE_NOT_FOUND",h}var d=n[s]={exports:{}};t[s][0].call(d.exports,function(e){var n=t[s][1][e];return a(n?n:e)},d,d.exports,e,t,n,i)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<i.length;s++)a(i[s]);return a}({ButtonScale:[function(e,t,n){"use strict";cc._RFpush(t,"f5ad20VNhBKe6qF/4EkPua1","ButtonScale"),cc.Class({"extends":cc.Component,properties:{sfx:cc.AudioClip,pressedScale:1,transDuration:0},onLoad:function(){function e(e){this.stopAllActions(),this.sfx&&cc.audioEngine.playEffect(this.sfx,!1),this.runAction(n.scaleDownAction)}function t(e){this.stopAllActions(),this.runAction(n.scaleUpAction)}var n=this;n.initScale=this.node.scale,n.button=n.getComponent(cc.Button),n.scaleDownAction=cc.scaleTo(n.transDuration,n.pressedScale),n.scaleUpAction=cc.scaleTo(n.transDuration,n.initScale),this.node.on("touchstart",e,this.node),this.node.on("touchend",t,this.node),this.node.on("touchcancel",t,this.node)}}),cc._RFpop()},{}],Config:[function(e,t,n){"use strict";cc._RFpush(t,"4bdcftVFqVP7bZQoHLieZ87","Config");var i={lineCount:5,lineHeight:110,rowWidth:80,bottomY:-237,leftX:-158,rightX:760,loseHP:1,waveSpan:2,menuType:cc.Enum({MT_MAIN:1,MT_LOSE:-1,MT_WIN:-1,MT_HUD:-1,MT_DAOJU:-1}),gameResultType:cc.Enum({GRT_UNKNOW:0,GRT_LOSE:-1,GRT_EQUATE:-1,GRT_WIN:-1}),guaiType:[{id:0,name:"GT_NORMAL",prefab:"jiangshi_3"},{id:1,name:"GT_SPEED",prefab:"jiangshi_2"},{id:2,name:"GT_SLOW",prefab:"jiangshi_1"}],levels:[{day:1,spanMin:2,spanMax:2,waves:[{waveID:1,GT:"GT_NORMAL",count:1},{waveID:2,GT:"GT_NORMAL",count:2},{waveID:3,GT:"GT_NORMAL",count:3}]},{day:2,spanMin:0,spanMax:2,waves:[{waveID:1,GT:"GT_NORMAL",count:5},{waveID:2,GT:"GT_NORMAL",count:5},{waveID:2,GT:"GT_SLOW",count:1},{waveID:3,GT:"GT_NORMAL",count:10},{waveID:3,GT:"GT_SLOW",count:1}]},{day:3,spanMin:0,spanMax:1.5,waves:[{waveID:1,GT:"GT_NORMAL",count:15},{waveID:1,GT:"GT_SLOW",count:2},{waveID:2,GT:"GT_NORMAL",count:10},{waveID:2,GT:"GT_SLOW",count:3},{waveID:2,GT:"GT_SPEED",count:2},{waveID:3,GT:"GT_NORMAL",count:10},{waveID:3,GT:"GT_SLOW",count:5},{waveID:3,GT:"GT_SPEED",count:5}]},{day:4,spanMin:0,spanMax:1,waves:[{waveID:1,GT:"GT_NORMAL",count:10},{waveID:1,GT:"GT_SPEED",count:5},{waveID:2,GT:"GT_NORMAL",count:10},{waveID:2,GT:"GT_SLOW",count:3},{waveID:2,GT:"GT_SPEED",count:2},{waveID:3,GT:"GT_NORMAL",count:12},{waveID:3,GT:"GT_SLOW",count:3},{waveID:3,GT:"GT_SPEED",count:6}]},{day:5,spanMin:0,spanMax:1,waves:[{waveID:1,GT:"GT_SPEED",count:3},{waveID:2,GT:"GT_SPEED",count:10},{waveID:3,GT:"GT_SPEED",count:20}]}]};t.exports=i,cc._RFpop()},{}],DaoJu:[function(e,t,n){"use strict";cc._RFpush(t,"8fc91JOmp9FT4GKTEcPp0g6","DaoJu"),cc.Class({"extends":cc.Component,properties:{hp:0,slow:0},onLoad:function(){}}),cc._RFpop()},{}],GameHud:[function(e,t,n){"use strict";cc._RFpush(t,"eb78fTpuL9ACImPHeDp+QF0","GameHud");var i=e("Config");cc.Class({"extends":cc.Component,properties:{mainMenu:cc.Node,loseMenu:cc.Node,winMenu:cc.Node,mask:cc.Node,hud:cc.Node},onLoad:function(){this.mainMenu.active=!0,this.loseMenu.active=!1,this.winMenu.active=!1,this.mask.active=!1,this.hud.active=!1,this.hudManager=this.hud.getComponent("Hud"),this.mainMenu.scaleX=0,this.mainMenu.runAction(cc.scaleTo(1,1))},showMenu:function(e,t){switch(e){case i.menuType.MT_MAIN:this.mainMenu.active=t,t&&(this.showMenu(i.menuType.MT_LOSE,!1),this.showMenu(i.menuType.MT_HUD,!1));break;case i.menuType.MT_LOSE:this.mask.active=t,this.loseMenu.active=t;break;case i.menuType.MT_WIN:this.mask.active=t,this.winMenu.active=t;break;case i.menuType.MT_HUD:this.hudManager.showDaoJu(!0),this.hud.active=t;break;case i.menuType.MT_DAOJU:this.hudManager.showDaoJu(t)}}}),cc._RFpop()},{Config:"Config"}],GameLogic:[function(e,t,n){"use strict";cc._RFpush(t,"303bci0Z8ZBooFBCsSyym+5","GameLogic");var i=e("Config");cc.Class({"extends":cc.Component,properties:{guaiList:[cc.Prefab],gameHud:cc.Node,gameLayer:cc.Node,game:{"default":null,serializable:!1,visible:!1}},onLoad:function(){this.gameHud=this.gameHud.getComponent("GameHud");var e=this.gameLayer.getChildByName("Mask");e.setLocalZOrder(1),this.setGameResult(i.gameResultType.GRT_UNKNOW)},init:function(e){this.level=i.levels[e],this.wavesIndex=0,this.waveID=0,this.curWave=[0],this._count=0,this._addCount=0,this._catchCount=0},addOneGuai:function(){if(this._addCount<this._count){for(var e=Math.ceil(1e4*cc.random0To1())%(this._count-this._addCount),t=1;t<this.curWave.length;t+=2){if(!(this.curWave[t]<e)){for(var n=0;n<i.guaiType.length;n++)if(i.guaiType[n].name==this.curWave[t-1]){cc.log("添加第 "+this._addCount+" 个怪。");var a=cc.instantiate(this.guaiList[i.guaiType[n].id]);a.tag=1,this.node.addChild(a),a.getComponent("jiangshi").shuaguai=this}break}e-=this.curWave[t]}var o=this.level.spanMin;o<this.level.spanMax&&(o+=cc.random0To1()*(this.level.spanMax-o)),this.node.runAction(cc.sequence(cc.delayTime(o),cc.callFunc(this.addOneGuai,this))),this._addCount+=1}else cc.log("第 "+this.waveID+" 波怪刷完。")},loadNextWave:function(){this.waveID+=1,this.curWave.length=0,this._count=0,this._addCount=0,this._catchCount=0;for(var e=0,t=this.level.waves,n=this.wavesIndex;n<t.length;n++){var i=t[n];if(i.waveID!=this.waveID)break;this.curWave[e++]=i.GT,this.curWave[e++]=i.count,this._count+=i.count,cc.log("第 "+i.waveID+" 波，"+i.GT+" 类型怪 "+i.count+" 个。")}return this.wavesIndex=n,e>0},playNextWave:function(){this.loadNextWave()?this.addOneGuai():cc.log("the last wave")},stopAllChildActions:function(){this.node.stopAllActions();for(var e=this.node.getChildren(),t=0;t<e.length;t++)1==e[t].tag&&(e[t].stopActionByTag(1),e[t].getComponent("jiangshi").beActive=!1)},removeAllChildrenByTag:function(e){for(var t=this.node.getChildren(),n=t.length-1;n>=0;n--)t[n].tag==e&&(t[n].active=!1,this.node.removeChild(t[n]))},addCatchCount:function(){this._catchCount++,this._catchCount==this._count&&(this.wavesIndex<this.level.waves.length?this.node.runAction(cc.sequence(cc.delayTime(i.waveSpan),cc.callFunc(this.playNextWave,this))):this.gameWin())},setGameResult:function(e){this.gameResult=e},gameStart:function(){this.gameHud.showMenu(i.menuType.MT_MAIN,!1),this.gameLayer.runAction(cc.sequence(cc.moveBy(1,cc.p(-460,0)),cc.callFunc(this.startPlaying,this)))},gameLose:function(){this.stopAllChildActions(),this.setGameResult(i.gameResultType.GRT_LOSE),this.gameHud.showMenu(i.menuType.MT_LOSE,!0)},gameWin:function(){this.setGameResult(i.gameResultType.GRT_WIN),this.game.addOneDay(),this.gameHud.showMenu(i.menuType.MT_WIN,!0)},replay:function(){this.gameHud.showMenu(i.menuType.MT_LOSE,!1),this.removeAllChildrenByTag(1),this.startPlaying()},continumPlay:function(){this.gameHud.showMenu(i.menuType.MT_WIN,!1),this.startPlaying()},showMainMenu:function(){this.gameHud.showMenu(i.menuType.MT_MAIN,!0),this.removeAllChildrenByTag(1);var e=this.gameLayer.getPosition().add(cc.p(460,0));this.gameLayer.setPosition(e)},startPlaying:function(){this.setGameResult(i.gameResultType.GRT_UNKNOW),this.init(this.day),this.gameHud.showMenu(i.menuType.MT_HUD,!0)}}),cc._RFpop()},{Config:"Config"}],GameManager:[function(e,t,n){"use strict";cc._RFpush(t,"37368DIIE1Fgq/JQ1HejiLJ","GameManager");var i=e("Config"),a=cc.Class({"extends":cc.Component,properties:{today:0},statics:{instance:null},onLoad:function(){a.instance=this,this.gameLogic=this.node.getComponent("GameLogic"),this.gameLogic.game=this,this.day=this.today},getLevelsConfig:function(){return i.levels[this.day]},getDay:function(){return this.day},addOneDay:function(){this.day+=1;var e=this.getLevelsConfig();this.day>=e.length&&(cc.log("game finished, and will be repalying."),this.day=0)}});cc._RFpop()},{Config:"Config"}],Hud:[function(e,t,n){"use strict";cc._RFpush(t,"5f282nhDPdCgrj6Aihc0YPa","Hud"),cc.Class({"extends":cc.Component,properties:{daoJu:cc.Node,day:cc.Node,coin:cc.Node},onLoad:function(){},showDaoJu:function(e){this.daoJu.active=e}}),cc._RFpop()},{}],JiangShi:[function(e,t,n){"use strict";cc._RFpush(t,"2df78uYR5BH2JTjy+GODKyE","JiangShi");var i=e("Config");cc.Class({"extends":cc.Component,properties:{hp:0,speed:0,power:0,shuaguai:{"default":null,serializable:!1,visible:!1}},onLoad:function(){this.beActive=!0;var e=Math.ceil(1e4*cc.random0To1())%i.lineCount*i.lineHeight+i.bottomY;this.node.setPosition(i.rightX,e);var t=this.moveAction();t.tag=1,this.node.runAction(t),this.node.on(cc.Node.EventType.TOUCH_START,this.onTouch,this)},moveAction:function(){var e=cc.moveBy(1,cc.p(-i.rowWidth/this.speed,0));return cc.repeatForever(cc.sequence(e))},isMoveEnd:function(){this.node.x<i.leftX&&(this.node.stopAllActions(),this.gameLose())},onTouch:function(){this.beHit()&&this.dropCoin()},beHit:function(){return!(0==this.beActive||this.hp<1)&&(this.hp-=i.loseHP,this.hp<1&&this.dead(),!0)},dropCoin:function(){},dead:function(){this.node.off(cc.Node.EventType.TOUCH_START,this.onTouch,this),this.node.destroy(),this.shuaguai.addCatchCount()},gameLose:function(){cc.log("game lose"),this.beActive=!1,this.node.stopActionByTag(1),cc.director.getScheduler().pauseTarget(this.node),this.shuaguai.gameLose()},update:function(e){this.beActive&&this.node.x<i.leftX&&this.gameLose()}}),cc._RFpop()},{Config:"Config"}]},{},["JiangShi","GameLogic","GameManager","Config","Hud","DaoJu","GameHud","ButtonScale"]);